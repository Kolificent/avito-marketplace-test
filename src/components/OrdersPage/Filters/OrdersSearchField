import { TextField } from '@mui/material';
import { useAppDispatch, useAppSelector } from '../../../store/store';
import { ChangeEvent, useEffect, useState } from 'react';
import { useDebouncedCallback } from 'use-debounce';
import { selectOrdersQuery } from '../../../selectors/ordersSelector';
import { changeOrdersQuery } from '../../../slices/orders';

function OrdersSearchField() {
  const initialQuery = useAppSelector(selectOrdersQuery);
  const [tempQuery, setTempQuery] = useState(initialQuery);
  const dispatch = useAppDispatch();

  const debounceTime = 400;
  const debouncedSetQuery = useDebouncedCallback((value) => {
    dispatch(changeOrdersQuery(value));
  }, debounceTime);

  useEffect(() => {
    setTempQuery(initialQuery);
  }, [initialQuery]);

  function handleChange(e: ChangeEvent<HTMLInputElement>) {
    const input = e.target.value;
    setTempQuery(input);
    debouncedSetQuery(input);
  }

  return (
    <TextField
      fullWidth
      value={tempQuery}
      onChange={handleChange}
      placeholder="Найти заказ по артикулу товара (id)"
      InputProps={{
        disableUnderline: true,
        sx: { fontSize: 'default' },
      }}
      variant="standard"
    />
  );
}
